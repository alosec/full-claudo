#!/bin/bash

# Full Claudo - Simple Multi-Agent Claude System
# Usage: claudo up|down|logs|plan|worker|critic|oracle|--version|-v

# Detect if we're running in container or on host
# Check if we're in a Docker container environment
if [[ -f "/.dockerenv" ]] && [[ -d "/usr/local/lib/claudo" ]]; then
  CLAUDO_LIB="/usr/local/lib/claudo"
else
  # Running on host - use local dist directory
  SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
  CLAUDO_LIB="$SCRIPT_DIR"
fi

# Handle version flag
if [[ "$1" == "--version" || "$1" == "-v" ]]; then
  # Extract version from package.json
  if [[ -f "/usr/local/lib/claudo/package.json" ]]; then
    VERSION=$(node -p "require('/usr/local/lib/claudo/package.json').version")
  elif [[ -f "package.json" ]]; then
    VERSION=$(node -p "require('./package.json').version")  
  else
    VERSION="unknown"
  fi
  echo "claudo version $VERSION"
  exit 0
fi

case "$1" in
  up)
    echo "[claudo] Starting Manager..."
    node "$CLAUDO_LIB/dist/up.js"
    ;;
  down)
    echo "[claudo] Stopping Manager..."
    node "$CLAUDO_LIB/dist/down.js"
    ;;
  logs)
    node "$CLAUDO_LIB/dist/logs.js" "$@"
    ;;
  plan|worker|critic|oracle)
    node "$CLAUDO_LIB/dist/agent.js" "$@"
    ;;
  *)
    echo "Usage: claudo {up|down|logs|plan|worker|critic|oracle|--version|-v} [args...]"
    exit 1
    ;;
esac